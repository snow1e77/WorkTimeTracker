# WorkTime Tracker Server API

–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞—Ö.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì± JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ä–æ–ª—è–º–∏
- üèóÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
- üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å (–≥–µ–æ—Ñ–µ–Ω—Å–∏–Ω–≥)
- ‚è∞ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö —Å–º–µ–Ω
- üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
- üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- üö® –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–π

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js >= 18.0.0
- PostgreSQL >= 13
- npm –∏–ª–∏ yarn

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`:

```bash
cp env.example .env
```

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
# –°–µ—Ä–≤–µ—Ä
PORT=3001
NODE_ENV=development

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://username:password@localhost:5432/worktime_tracker

# JWT
JWT_SECRET=your_super_secret_jwt_key
JWT_REFRESH_SECRET=your_super_secret_refresh_key
JWT_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# Authentication (Simple phone number login)

# CORS
CORS_ORIGINS=http://localhost:19006,http://localhost:3000,http://localhost:8081

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npm run db:migrate

# –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
npm run db:seed
```

### –ó–∞–ø—É—Å–∫

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –°–±–æ—Ä–∫–∞
npm run build

# –ü—Ä–æ–¥–∞–∫—à–Ω
npm run start:prod
```

## API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (`/api/auth`)


- `POST /login` - –í—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `POST /register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `POST /logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (`/api/users`)

- `GET /` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∞–¥–º–∏–Ω)
- `GET /:id` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `POST /` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω)
- `PUT /:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω)
- `DELETE /:id` - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω)
- `GET /stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∞–¥–º–∏–Ω)

### –û–±—ä–µ–∫—Ç—ã (`/api/sites`)

- `GET /` - –°–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
- `GET /:id` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ
- `POST /` - –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (–∞–¥–º–∏–Ω)
- `PUT /:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (–∞–¥–º–∏–Ω)
- `DELETE /:id` - –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (–∞–¥–º–∏–Ω)
- `POST /:id/check-location` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –≤ –∑–æ–Ω–µ –æ–±—ä–µ–∫—Ç–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è (`/api/assignments`)

- `GET /` - –°–ø–∏—Å–æ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
- `GET /:id` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏
- `POST /` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–∞–¥–º–∏–Ω)
- `PUT /:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–∞–¥–º–∏–Ω)
- `DELETE /:id` - –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–∞–¥–º–∏–Ω)
- `GET /user/:userId` - –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /site/:siteId` - –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞

### –°–º–µ–Ω—ã (`/api/shifts`)

- `GET /` - –°–ø–∏—Å–æ–∫ —Å–º–µ–Ω
- `GET /:id` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–º–µ–Ω–µ
- `POST /start` - –ù–∞—á–∞–ª–æ —Å–º–µ–Ω—ã
- `POST /:id/end` - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–º–µ–Ω—ã
- `GET /my` - –ú–æ–∏ —Å–º–µ–Ω—ã
- `GET /active` - –ê–∫—Ç–∏–≤–Ω–∞—è —Å–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–º–µ–Ω

### –û—Ç—á–µ—Ç—ã (`/api/reports`)

- `GET /work` - –†–∞–±–æ—á–∏–µ –æ—Ç—á–µ—Ç—ã
- `GET /violations` - –û—Ç—á–µ—Ç—ã –ø–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è–º (–∞–¥–º–∏–Ω)
- `GET /statistics` - –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∞–¥–º–∏–Ω)
- `GET /export/:type` - –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤ –≤ CSV (–∞–¥–º–∏–Ω)

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (`/api/sync`)

- `GET /` - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `POST /` - –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `GET /status` - –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- `POST /full` - –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ database.ts          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ migrate.ts           # –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ migrations.sql       # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ seed.ts             # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ auth.ts             # Middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts             # –†–æ—É—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ users.ts            # –†–æ—É—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ sites.ts            # –†–æ—É—Ç—ã –æ–±—ä–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ assignments.ts      # –†–æ—É—Ç—ã –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ shifts.ts           # –†–æ—É—Ç—ã —Å–º–µ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ reports.ts          # –†–æ—É—Ç—ã –æ—Ç—á–µ—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ sync.ts             # –†–æ—É—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.ts      # –°–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ UserService.ts      # –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ SiteService.ts      # –°–µ—Ä–≤–∏—Å –æ–±—ä–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ AssignmentService.ts # –°–µ—Ä–≤–∏—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ ShiftService.ts     # –°–µ—Ä–≤–∏—Å —Å–º–µ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ ReportService.ts    # –°–µ—Ä–≤–∏—Å –æ—Ç—á–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ SyncService.ts      # –°–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts            # TypeScript —Ç–∏–ø—ã
‚îî‚îÄ‚îÄ index.ts                # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- Health check endpoint: `GET /health`
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ: `GET /api/info`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT 