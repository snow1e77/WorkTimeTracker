# Использование системы синхронизации WorkTime

## Обзор функционала

Система синхронизации обеспечивает:
- Назначение рабочих на конкретные объекты администратором
- Синхронизацию данных между мобильным приложением и веб админ-панелью
- Контроль доступа рабочих только к назначенным объектам

## Для администраторов (веб-панель)

### 1. Доступ к админ-панели
- Откройте веб-приложение
- Войдите с учетными данными администратора
- Перейдите на вкладку "Assignments"

### 2. Создание назначений
1. В разделе "Create New Assignment":
   - Выберите рабочего из списка
   - Выберите строительный объект
   - Добавьте заметки (опционально)
   - Нажмите "Create Assignment"

### 3. Управление назначениями
- **Активация/Деактивация**: Используйте кнопку "Activate"/"Deactivate"
- **Удаление**: Кнопка "Delete" для полного удаления назначения
- **Просмотр**: Все назначения отображаются в таблице с полной информацией

### 4. Синхронизация
- Данные автоматически синхронизируются каждые 5 минут
- Принудительная синхронизация доступна через API
- Статус синхронизации отображается в консоли браузера

## Для рабочих (мобильное приложение)

### 1. Получение назначений
- При входе в приложение автоматически загружаются назначенные объекты
- Отображаются только активные назначения
- Недоступные объекты не показываются в списке

### 2. Работа с назначенными объектами
- Выбор объекта для отметки времени
- GPS-контроль нахождения на объекте
- Автоматическое отслеживание рабочего времени

### 3. Синхронизация данных
- Данные синхронизируются при подключении к интернету
- Офлайн-режим с сохранением данных локально
- Автоматическая отправка данных при восстановлении связи

## Технические детали

### Структура данных назначений
```typescript
interface UserSiteAssignment {
  id: string;
  userId: string;           // ID рабочего
  siteId: string;          // ID объекта
  assignedBy: string;      // ID администратора
  isActive: boolean;       // Статус назначения
  assignedAt: Date;        // Дата назначения
  validFrom?: Date;        // Начало действия (опционально)
  validTo?: Date;          // Окончание действия (опционально)
  notes?: string;          // Заметки
}
```

### API для синхронизации
- `GET /api/assignments/user/:userId` - получить назначения пользователя
- `POST /api/assignments` - создать новое назначение
- `PUT /api/assignments/:id` - обновить назначение
- `DELETE /api/assignments/:id` - удалить назначение
- `POST /api/sync` - синхронизация данных

### Безопасность
- Рабочие видят только свои назначения
- Администраторы имеют полный доступ ко всем назначениям
- Данные шифруются при передаче
- Локальные данные защищены

## Примеры использования

### Сценарий 1: Назначение нового рабочего
1. Администратор создает пользователя в системе
2. Назначает его на конкретный объект через веб-панель
3. Рабочий получает уведомление о назначении
4. При входе в мобильное приложение видит только назначенный объект

### Сценарий 2: Смена объекта
1. Администратор деактивирует старое назначение
2. Создает новое назначение на другой объект
3. Данные синхронизируются автоматически
4. Рабочий видит обновленный список объектов

### Сценарий 3: Временное назначение
1. Администратор создает назначение с датами validFrom/validTo
2. Назначение автоматически активируется/деактивируется по датам
3. Рабочий получает доступ только в указанный период

## Устранение неполадок

### Проблемы синхронизации
- Проверьте подключение к интернету
- Убедитесь, что сервер доступен
- Проверьте логи в консоли браузера/мобильного приложения

### Назначения не отображаются
- Убедитесь, что назначение активно (isActive = true)
- Проверьте даты validFrom/validTo
- Убедитесь, что объект активен

### Производительность
- Система оптимизирована для работы с тысячами назначений
- Данные кэшируются локально для быстрого доступа
- Синхронизация происходит в фоновом режиме

## Планы развития

### Ближайшие обновления
- Push-уведомления о новых назначениях
- Групповые назначения
- Шаблоны назначений
- Аналитика по назначениям

### Долгосрочные планы
- Интеграция с системами учета рабочего времени
- Мобильные уведомления
- Расширенная аналитика
- API для интеграции с внешними системами 